<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>/v1/mbox and /v2/batchmbox/ Legacy Target API</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #272822;
  background-color: #f92672;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #75715e;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #f8f8f2;
}
.highlight .p, .highlight .pi {
  color: #f8f8f2;
}
.highlight .gi {
  color: #a6e22e;
}
.highlight .gd {
  color: #f92672;
}
.highlight .gh {
  color: #66d9ef;
  background-color: #272822;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #ae81ff;
}
.highlight .kc {
  color: #fd971f;
}
.highlight .kt {
  color: #fd971f;
}
.highlight .kd {
  color: #fd971f;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #a6e22e;
}
.highlight .sr {
  color: #a1efe4;
}
.highlight .si {
  color: #cc6633;
}
.highlight .se {
  color: #cc6633;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #66d9ef;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #a6e22e;
}
.highlight .ss {
  color: #a6e22e;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
    <link href="images/favicon.ico" rel="icon" type="image/ico" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" alt="Logo" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="legacy-v1-mbox-and-v2-batchmbox-api">Legacy /v1/mbox and /v2/batchmbox API</h1>

<p>This API documentation outlines the legacy /v1/mbox and /v2/batchmbox API. It is highly recommended that customers use the new /v1/delivery API.</p>

<h1 id="server-side-delivery">Server Side Delivery</h1>

<p>The Server Side Delivery API is designed to deliver experiences with any server side platform or an application that can make HTTP/s calls. This is valuable for organizations that want to deliver targeting to a non-browser based IoT device, such as a connected TV, kiosk, or in-store digital screen.</p>

<h2 id="getting-started">Getting Started</h2>

<p>Deliver your Target experiments &amp; personalizations using the Delivery API with three simple steps:</p>

<ol>
<li>Identify your Experience Cloud tenant name and Target client code. Note that the tenant name and client code may be different for your organization.

<ol>
<li>Tenant Name: Your tenant name is the subdomain part of your Experience Cloud URL. For example, if your Experience Cloud URL is <em>mytenant.marketing.adobe.com</em>, your tenant name is <em>mytenant</em>.</li>
<li>Client Code: Your Target Client Code can be retrieved from the Target UI as described <a href="https://marketing.adobe.com/resources/help/en_US/target/ov2/c_target-atjs-advanced-settings.html">here</a>.</li>
</ol></li>
<li>Create a Target Activity (A/B, XT, AP or Recommendations) using the <a href="https://marketing.adobe.com/resources/help/en_US/target/target/t_form_experience_composer.html">Form-Based Composer</a></li>
<li>Use the Server Side (or Batch) Delivery API to get response for the mboxes used in the Target Activity created in step 1.</li>
<li>Present the experience to the visitor!</li>
</ol>

<p>Note the following characteristics of the Delivery API:</p>

<ol>
<li>The delivery API enables you to get experiences/offers for an mbox and an audience segment in a RESTful manner.</li>
<li>There is <strong>no authentication</strong> for Target Delivery APIs.</li>
<li>This API does not process cookies or redirect calls.</li>
<li>There is no notion of a &ldquo;user role&rdquo; in the Server Side Delivery API because it represents a call to fetch content or report events to Target edge servers.</li>
</ol>

<h2 id="best-practices">Best Practices</h2>

<ol>
<li>The response of the Delivery API includes the <em>edgeHost</em> parameter. This is the URL of the Target edge that served this request. All subsequent requests for this visitor/session should be sent to this edge.</li>
<li>The session-id in the REST API must be unique for every visitor in your application.</li>
<li>Use mboxTrace with a Debug Authentication Token to debug your API integrations. The Debug Authentication Token is valid for six hours and needs to be refreshed accordingly.</li>
<li>You can pass user-agent in the request header in order to leverage browser and device based audience segmentations.</li>
</ol>

<h2 id="input-parameters">Input Parameters</h2>

<blockquote>
<p>Delivery API Sample Request. This is a request with just the mbox name in the POST body.</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST <span class="se">\</span>
  <span class="s1">'https://&lt;your-client-code&gt;.tt.omtrdc.net/rest/v1/mbox/my-session-id?client=&lt;your-client-code&gt;'</span> <span class="se">\</span>
  -H <span class="s1">'cache-control: no-cache'</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -d <span class="s1">'{
  "mbox" : "my-mbox-name"
}'</span>

</code></pre>
<blockquote>
<p>Response for Sample Request</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"tntId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"111499796294071-449025.28_44"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"edgeHost"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mboxedge28.tt.omtrdc.net"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Use 10OFF for $10 off for orders over $100"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"sessionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"my-session-id"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Delivery API request with all possible inputs</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST <span class="se">\</span>
  <span class="s1">'https://&lt;your-client-code&gt;.tt.omtrdc.net/rest/v1/mbox/A210702C-402F-4458-9869-FCE64F318AE6?client=&lt;your-tenant-name&gt;'</span> <span class="se">\</span>
  -H <span class="s1">'cache-control: no-cache'</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.75.14 (KHTML, like Gecko) Version/7.0.3 Safari/7046A194A'</span> <span class="se">\</span>
  -d <span class="s1">'{
  "mbox" : "a1-mobile-ab",
  "thirdPartyId" : "12345abcde",
  "profileParameters" : {
    "param1" : "value1",
    "param2" : "value2",
    "entity.id" : "entityId",
    "entity.name" : "entityName"
  },
  "mboxParameters" : {
    "screenHeight": 1057,
    "screenWidth": 1920,
    "browserWidth": 1040,
    "browserHeight": 960,
    "browserTimeOffset": 240,
    "colorDepth": 24,
    "mboxXDomain": "enabled",
    "mboxMCGVID": "91394045728588414913028121188926585416",
    "mboxAAMB": "cIBAx_aQzFEHcPoEv0GwcQ",
    "mboxMCGLH": 7,
    "vst.alias.id" : "2342345364532",
    "vst.alias.authState" : "1"
 },
  "requestLocation" : {
    "pageURL" : "http://demo/demo/store/",
    "referrerURL" : "http://demo/demo/store/",
    "ipAddress" : "128.10.10.1",
    "impressionId" : "15989",
    "host" : "staging-1"
  }
}'</span>

</code></pre>
<blockquote>
<p>Response for Delivery API request with all inputs</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"thirdPartyId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"12345abcde"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"edgeHost"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mboxedge28.tt.omtrdc.net"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Get 5% off using code 5OFF!"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"sessionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A210702C-402F-4458-9869-FCE64F318AE6"</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre>
<h3 id="post-request">POST Request</h3>

<p>The Server Side Delivery API only supports POST requests.  Here is a sample POST call performed using the API.</p>

<p><code class="prettyprint">https://your-client-code.tt.omtrdc.net/rest/v1/mbox/my-session-123?client=your-client-code</code></p>

<p>In this request,</p>

<table>
    <tbody>
        <tr>
            <td>my-session-123</td>
            <td>
                <p>This is the Session Id that should be generated and maintained by you. The Session Id can be any printable string except a space, ?, or /. It should be between 1 and 128 characters in length.</p>
                <p>For a particular session, its value must stay the same across multiple requests.</p>
                <p>Routing to a particular node in the edge cluster is done using Session Id.</p>
                <p>**The session is active for 30 minutes on the server side. Therefore, you shouldn&rsquo;t use a different SessionId for a particular tntId/thirdPartyId within 30 minutes of the last request made with the tntId/thirdPartyId. Otherwise, changes to the profile could be inconsistent and unpredictable.**</p>
                <p>**Using the same Session ID with multiple tntIds/thirdPartyIds may cause unpredictable changes to the profiles identified by the tntId/thirdPartyIDs.**</p>
            </td>
        </tr>
        <tr>
            <td>your-client-code</td>
            <td>Your account&rsquo;s client code. This parameter is mandatory for each request.</td>
        </tr>
    </tbody>
</table>

<p>The list of parameters that you can supply in the body of the request.</p>

<h3 id="request-parameters">Request Parameters</h3>

<table class="delivery-api">
    <thead>
        <tr>
            <th>Parameter</th>
            <th>Description</th>
            <th>Default Value</th>
            <th>Validation</th>
        </tr>
    </thead>
    <tbody>
        <tr class="odd">
            <td class="first">mbox</td>
            <td>The mbox name.</td>
            <td>None, it cannot be empty.</td>
            <td class="last">
                <p>Same validation as for all mbox calls.</p>
                <p>1 &lt; Length &lt; 250</p>
                <p>Cannot contains any of the following characters: &rsquo;, &ldquo;, %22, %27, &lt;, &gt;, %3C, %3E</p>
            </td>
        </tr>
        <tr>
            <td class="first">clicked</td>
            <td>
                <p>Equivalent of using the &rdquo;-clicked&quot; suffix in mbox names for mbox calls.</p>
                <p><i>Click mboxes only work for campaigns with metrics that have a specific mbox selected, for example &ldquo;click from homePageHer&rdquo; and will not work if &ldquo;click from display mboxes&rdquo; is selected.</i>
                </p>
                <p>&nbsp;</p>
            </td>
            <td>False</td>
            <td class="last">Can be empty or true/false</td>
        </tr>
        <tr class="odd">
            <td class="first">tntId</td>
            <td>New name for pcId/mboxPC.</td>
            <td>
                <p>Empty.</p>
                <p>If no &ldquo;thirdPartyId&rdquo; was provided, a new tntId is generated and returned as part of the response. Otherwise remains empty.</p>
            </td>
            <td class="last">
                <p>1 &lt; Length &lt; 128</p>
                <p>Cannot contain more than a single &ldquo;.&rdquo; (dot).</p>
                <p>The only dot allowed is for profile location suffix.</p>
            </td>
        </tr>
        <tr>
            <td class="first">thirdPartyId</td>
            <td>Client-provided visitor ID.</td>
            <td>Empty</td>
            <td class="last">1 &lt; Length &lt; 128</td>
        </tr>
        <tr class="odd">
            <td class="first">marketingCloudVisitorId</td>
            <td>Marketing Cloud Visitor ID</td>
            <td>Empty</td>
            <td class="last">1 &lt; Length &lt; 128</td>
        </tr>
        <tr>
            <td class="first">order > total</td>
            <td>Order amount associated with the order</td>
            <td>Empty</td>
            <td class="last">If not empty, should be a valid decimal</td>
        </tr>
        <tr class="odd">
            <td class="first">order.id</td>
            <td>Order reference ID</td>
            <td>Empty</td>
            <td class="last">If not empty, Length &lt; 250</td>
        </tr>
        <tr>
            <td class="first">order > purchasedProductIds</td>
            <td>Order referenced product IDs</td>
            <td>Empty</td>
            <td class="last">
                <p>Each ID cannot exceed 50 char length.</p>
                <p>Total length of comma-delimited IDs as string cannot exceed 250 chars</p>
            </td>
        </tr>
        <tr class="odd">
            <td class="first">profileParameters</td>
            <td>
                <p>Parameters that should be set in the profile.</p>
                <p>The end values in the profile are saved as profile.param=value.</p>
            </td>
            <td>Empty</td>
            <td class="last">Cannot contain more than 50 parameters</td>
        </tr>
        <tr>
            <td class="first">profileParameters.[name]</td>
            <td>Profile parameter name</td>
            <td>Empty</td>
            <td class="last">
                <p>Length &lt; 128</p>
                <p>Should not start with &ldquo;profile.&rdquo; prefix.</p>
            </td>
        </tr>
        <tr class="odd">
            <td class="first">profileParameters.[value]</td>
            <td>Profile parameter value</td>
            <td>Empty</td>
            <td class="last">Length &lt; 256</td>
        </tr>
        <tr>
            <td class="first">mboxParameters</td>
            <td>Any mbox parameters that may need to be provided. eg. screenWidth.</td>
            <td>Empty</td>
            <td class="last">
                <p>Cannot contain more than 50 parameters.</p>
                <p>Cannot contain order-related parameters that should be set in &ldquo;order&rdquo;.</p>
                <p>Cannot contain parameters with &ldquo;profile.&rdquo; prefix. Those should be set in &ldquo;profileParameters&rdquo;.</p>
            </td>
        </tr>
        <tr class="odd">
            <td class="first">mboxParameters.[name]</td>
            <td>Mbox parameter name</td>
            <td>Empty</td>
            <td class="last">Length &lt; 128</td>
        </tr>
        <tr>
            <td class="first">mboxParameters.[value]</td>
            <td>Mbox parameter value</td>
            <td>Empty</td>
            <td class="last">Length &lt; 256</td>
        </tr>
        <tr class="odd">
            <td class="first">requestLocation > pageURL</td>
            <td>Equivalent to mboxURL mbox parameter</td>
            <td>Empty</td>
            <td class="last">
                <p>Valid URL.</p>
                <p>Length &lt; 3072</p>
            </td>
        </tr>
        <tr>
            <td class="first">requestLocation > referrerURL</td>
            <td>Equivalent to mboxReferrer mbox parameter</td>
            <td>Empty</td>
            <td class="last">
                <p>Valid URL</p>
                <p>Length &lt; 3072</p>
            </td>
        </tr>
        <tr class="odd">
            <td class="first">requestLocation > ipAddress</td>
            <td>Override the IP address of the client server</td>
            <td>IP address or the server making the call</td>
            <td class="last">Valid IP address</td>
        </tr>
        <tr>
            <td class="first">requestLocation > impressionId</td>
            <td>
                <p>Equivalent of pageId.</p>
                <p>A unique one is generated with each request if no value was specified.</p>
            </td>
            <td>Empty</td>
            <td class="last">Length &lt; 128</td>
        </tr>
        <tr class="odd">
            <td class="first">requestLocation > host</td>
            <td>Equivalent of mboxHost</td>
            <td>&ldquo;unknown&rdquo;</td>
            <td class="last">Length &lt; 250</td>
        </tr>
        <tr>
            <td class="first">mboxTrace</td>
            <td>Enabled detailed tracing of the call for debugging</td>
            <td>False</td>
            <td class="last">Empty/True/False
                <a name="section_E846261F8F28465C91A7217AD11A2EB9"></a>
            </td>
        </tr>
    </tbody>
</table>

<h3 id="response-parameteres">Response Parameteres</h3>

<table>
    <thead>
        <tr class="odd">
            <th>Field Path</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td class="first">sessionId</td>
            <td class="last">Session ID that was provided for this call.</td>
        </tr>
        <tr class="odd">
            <td class="first">tntId</td>
            <td class="last">Provided or generated tntId.</td>
        </tr>
        <tr>
            <td class="first">thirdPartyId</td>
            <td class="last">thirdPartyId if one was provided.</td>
        </tr>
        <tr class="odd">
            <td class="first">mboxTrace</td>
            <td class="last">Serialized mbox trace details.<a name="section_D56E60F7655246D295EFD0FBE1E9B490"></a>
            </td>
        </tr>
    </tbody>
</table>

<h2 id="debugging-the-api">Debugging the API</h2>

<p>You can enable debugging in your API using mboxTrace by following these steps:</p>

<ol>
<li>Generate a Debug Authentication Token by following one of the following methods:

<ol>
<li>Retrieve the Authroization Token using the Target UI as explained <a href="https://marketing.adobe.com/resources/help/en_US/target/target/c_content_trouble.html">here</a>.</li>
<li>Use the Authentication Token API as described below.</li>
</ol></li>
<li>Set mboxTrace parameter as True in the API request</li>
</ol>

<h2 id="identifying-visitors">Identifying Visitors</h2>

<blockquote>
<p>Delivery Calls with differnt identifiers - Using a thirdPartyId</p>
</blockquote>
<pre class="highlight plaintext"><code>{
   "mbox" : "homePageHero",
   "thirdPartyId" : "customId-123"
}
</code></pre>
<blockquote>
<p>Response when a thirdPartyId is provided</p>
</blockquote>
<pre class="highlight plaintext"><code>{
   "content" : "content",
   "sessionId" : "999888",
   "thirdPartyId" : "customId-123"
}

</code></pre>
<blockquote>
<p>Request using the Marketing Cloud Visitor ID</p>
</blockquote>
<pre class="highlight plaintext"><code>{
   "mbox" : "homePageHero",
   "marketingCloudVisitorId" : "23131312312312123123"
}
</code></pre>
<blockquote>
<p>Request using all three identifiers</p>
</blockquote>
<pre class="highlight plaintext"><code>{
   "mbox" : "homePageHero",
   "tntId" : "1234343422.17_01",
   "marketingCloudVisitorId" : "23131312312312123123"
}
</code></pre>
<p>There are a multiple ways in which a Visitor can be identified in Target. Target uses three identifiers</p>

<ul>
<li><strong>tntId</strong> – This is the primary identifier in Target for an individual user. You can supply this id or Target will auto-generate it if the request doesn’t contain one. Also referred to as PCID or mboxPCID.</li>
<li><strong>thirdPartyId</strong> – This is your company’s internal identifier that you can send with every call. This could be your frequent flier number, loyalty id, crm id, guid etc,. Also referred as mbox3rdPartyID.</li>
<li><strong>marketingCloudVisitorId</strong> – This identifier is used to merge and share data between different Adobe solutions. The marketingCloudVisitorId  is required for features like Marketing Cloud Profiles and Audiences, Analytics for Target, Device graph etc.</li>
</ul>

<p>Learn how <a href="https://marketing.adobe.com/resources/help/en_US/target/target/c_3rd-party_id.html">profiles are merged and synced</a> in real time using the different identifiers.</p>

<h3 id="using-the-tntid">Using the tntId</h3>

<p>A tntId is generated if it isn&rsquo;t provided in the request. See the Sample Request #1 on the right.</p>

<p>Note that a new tntId is generated and provided in the response.  Subsequent requests need to include this TnT ID.</p>

<p><em>The tntId is not returned in the API response if a thirdPartyId or marketingCloudVisitorId is provided in the request.</em></p>

<h3 id="using-custom-ids">Using Custom IDs</h3>

<p>If you want to use Custom IDs to identify visitors (profiles), use the thirdPartyId. You must provide these IDs with every call.</p>

<h3 id="combining-ids">Combining IDs</h3>

<p>You can combine tntId/thirdPartyId/marketingCloudVisitorId and provide them in the same request. A typical scenario would be to provide tntId along with another ID.</p>

<aside class = "warning">
<b>Returning Visitors</b>: Calls for returning visitors need to include the identifier that was used initially, tntId or thirdPartyId.
</aside>

<aside class = "notice">
<b>SessionID</b>: The sessionId is another identifier that goes hand in hand with visitor identity. Refer to the <a href="#input-parameters">input parameters</a> section to learn more about the sessionId
</aside>

<h1 id="server-side-batch-delivery">Server Side Batch Delivery</h1>

<h2 id="batch-overview">Batch Overview</h2>

<blockquote>
<p>Batch Delivery Request with two mboxes and one prefetched mbox</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST <span class="se">\</span>
  https://&lt;your-client-code&gt;.tt.omtrdc.net/rest/v2/batchmbox?client<span class="o">=</span>&lt;your-client-code&gt;&amp;sessionId<span class="o">=</span>&lt;sessionId&gt; <span class="se">\</span>
  -H <span class="s1">'cache-control: no-cache'</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'session-id: your-unique-session-id'</span><span class="se">\</span>
  -d <span class="s1">'{
   "client": "&lt;your-client-code&gt;",
   "id": {
        "tntId": "123456789"
   },
   "mboxes": [
        {
            "indexId": 0,
            "mbox": "batch-req-1"
        },
        {
            "indexId": 1,
            "mbox": "batch-req-2"
        }
    ]
}'</span>
</code></pre>
<blockquote>
<p>Batch Delivery Response for two mboxes and one prefetched mbox</p>
</blockquote>
<pre class="highlight shell"><code><span class="o">{</span>
    <span class="s2">"requestId"</span>: <span class="s2">"77a45e19-732f-42ea-98de-e4a36ceecd55"</span>,
    <span class="s2">"client"</span>: <span class="s2">"&lt;your-client-code&gt;"</span>,
    <span class="s2">"id"</span>: <span class="o">{</span>
        <span class="s2">"tntId"</span>: <span class="s2">"123456789.28_3"</span>
    <span class="o">}</span>,
    <span class="s2">"edgeHost"</span>: <span class="s2">"mboxedge28.tt.omtrdc.net"</span>,
    <span class="s2">"contentAsJson"</span>: <span class="nb">false</span>,
    <span class="s2">"mboxResponses"</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">"mbox"</span>: <span class="s2">"batch-req-1"</span>,
            <span class="s2">"content"</span>: <span class="s2">"batch-response-1a"</span>
        <span class="o">}</span>,
        <span class="o">{</span>
            <span class="s2">"mbox"</span>: <span class="s2">"batch-req-2"</span>,
            <span class="s2">"content"</span>: <span class="s2">"batch-response-2a"</span>
        <span class="o">}</span>
    <span class="o">]</span>,
    <span class="s2">"prefetchResponses"</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">"mbox"</span>: <span class="s2">"batch-req-3"</span>,
            <span class="s2">"content"</span>: <span class="s2">"batch-response-3a"</span>,
            <span class="s2">"eventTokens"</span>: <span class="o">[</span>
              <span class="s2">"OXszbV+Odw+fblLkzmgrW2qipfsIHvVzTQxHolz2IpSCnQ9Y9OaLL2gsdrWQTvE5wM++BveH6AIK0pfQ2QUzsg=="</span>
            <span class="o">]</span>
        <span class="o">}</span>
    <span class="o">]</span>
<span class="o">}</span>
</code></pre>
<p>The Batch Delivery API allows requesting content for multiple mboxes in a single call, therefore improving performance and flexibility in delivery. The Batch Delivery API has two capabilities, both of which can be used together:</p>

<ol>
<li>Batch Mbox: You can request the offers for multiple mboxes with a single API request. The behavior of this capability is same as the Delivery API for a single mbox.</li>
<li>Prefetch: A prefetch mode that enables clients like mobile apps, servers etc to fetch content for multiple mboxes in one request, cache it locally and later notify Target when the user visits those mboxes.</li>
</ol>

<p>Here are some common terms that you need to be familiar with when using the Batch Delivery API. </p>

<ul>
<li><strong>mboxes</strong> – List of mboxes that should be fetched and marked as visited immediately on content delivery. If you just want to get the content for multiple mboxes but don&rsquo;t have a necessary to prefetch and cache them, use this. </li>
<li><strong>prefetch</strong> – List of mboxes that should be fetched but shouldn&rsquo;t be marked as visited. The Target edge returns an eventToken for each mbox that is present in the the prefetch array</li>
<li><strong>notifications</strong> – List of mboxes that were previously prefetched and should be marked as visited. </li>
<li><strong>eventTokens</strong> – A hashed encrypted token that is returned when content is prefetched. This eventToken should be sent back to Target in the notifications array. </li>
</ul>

<aside class="notice">
Don&rsquo;t forget to replace the clientcode and the mbox name with your own in the API calls. The APIs in the collection use a demo account.
</aside>

<h3 id="known-limitations">Known Limitations</h3>

<aside class = "warning">
<b>Support for AP and Recs Activities</b>: This API has two modes for fetching content - regular mbox batch mode and prefetch mode. The prefetch mode can only be used for AB and XT activities. Don’t use the prefetch mode for Automated Personalization, Auto-Allocate, Auto-Target and Recommendations activty types. Prefetch support for these activity types will be added in the future. The API request and response structure won’t change when the support is added. 
</aside>

<aside class = "notice">
<b>The batch mode or the “mboxes” object in the API can be used for all activity types</b>: If you are looking to fetch the content for multiple mboxes is a single call, this is a great option. 
</aside>

<h2 id="batch-input-parameters">Batch Input Parameters</h2>

<blockquote>
<p>Batch Delivery with all possible inputs</p>
</blockquote>
<pre class="highlight shell"><code>curl -X POST <span class="se">\</span>
  https://&lt;your-client-code&gt;.tt.omtrdc.net/rest/v2/batchmbox?client<span class="o">=</span>&lt;your-client-code&gt;&amp;sessionId<span class="o">=</span>&lt;sessionId&gt; <span class="se">\</span>
  -H <span class="s1">'cache-control: no-cache'</span> <span class="se">\</span>
  -H <span class="s1">'content-type: application/json'</span> <span class="se">\</span>
  -H <span class="s1">'session-id: your-unique-session-id'</span> <span class="se">\</span>
  -H <span class="s1">'user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.75.14 (KHTML, like Gecko) Version/7.0.3 Safari/7046A194A'</span> <span class="se">\</span>
  -d <span class="s1">'{
   "client": "&lt;your-client-code&gt;",
   "host": "www.foo.com",
   "ipAddress": "1.2.3.4",
   "trace" : { 
        "enabled": true,
        "includeMetrics": true
   },
   "id": {
        "tntId": "123456789",
        "thirdPartyId": "32jh4jk23h4kj2",
        "marketingCloudVisitorId": "92387492387543875638",
        "customerIds": [
            {
                "id": "32jh4jk23h4kj2",
                "integrationCode": "userid",
                "authenticatedState": "authenticated"
            }
        ]
   },
   "aamParameters": {
        "blob": "32fdghkjh34kj5h43",
        "uuid": "82394234238798437",
        "dcsLocationHint": 9,
        "dataPartnerId": 86567576,
        "dataPartnerUserId": 348382232423424
   },
   "contentAsJson": true,
   "profileParameters": {
        "age": "18"
   },
   "prefetch": [
        {
            "indexId": 0,
            "mbox": "batch-req-1",
            "parameters": {
                "T_GHY": "7563"
            },
            "product": {
                "id": "54353",
                "categoryId": "93284230"
            },
            "order": {
                "id": "343",
                "total": 125.34,
                "purchasedProductIds": ["762", "1253", "499"]
            }
        }
   ],
   "mboxes": [
        {
            "indexId": 0,
            "mbox": "batch-req-2",
            "parameters": {
                "T_GHY": "7563333"
            },
            "product": {
                "id": "5431153",
                "categoryId": "9328114230"
            },
            "order": {
                "id": "34366",
                "total": 1425.34,
                "purchasedProductIds": ["7632", "12253", "4949"]
            },
            "requestLocation": {
                "pageURL": "http://foo.com/welcome-bing",
                "referrerURL": "https://bing.com"
            }
        }
   ],
   "notifications": [
        {
            "timestamp": 1485216216,
            "mbox": "batch-req-3",
            "parameters": {
                "ad": "1"
            },
            "eventTokens": ["OXszbV+Odw+fblLkzmgrWwreqXMfVUcUx0s/BHR5kCKCnQ9Y9OaLL2gsdrWQTvE5wM++BveH6AIK0pfQ2QUzsg=="],
            "order": {
                "id": "34",
                "total": 125.34,
                "purchasedProductIds": ["76", "125", "99"]
            },
            "product": {
                "id": "54353",
                "categoryId": "93284230"
            }
        }
    ],
    "mboxOverride": {
        "ip": "184.58.98.74",
        "time": 123654735,
        "visitorPercentage": 78.54,
        "aamResponse": "982374982738",
        "aamSegments": "34,1243,56443"
    }
}'</span>
</code></pre>
<table>
    <tbody>
        <tr>
            <th>Field Name</th>
            <th>Required</th>
            <th>Validation</th>
        </tr>
        <tr>
            <td>client</td>
            <td>Y</td>
            <td>Valid client code</td>
        </tr>
        <tr>
            <td>trace</td>
            <td>N</td>
            <td>Enable mboxTrace for debugging by setting *enabled* as *true*</td>
        </tr>
        <tr>
            <td>id &rarr; tntId</td>
            <td>N</td>
            <td>
                <ul>
                    <li>Max size 128</li>
                    <li>Should not contain a dot, unless the dot delimits the location hint</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>id &rarr; thirdPartyId</td>
            <td>N</td>
            <td>Max size 128</td>
        </tr>
        <tr>
            <td>id &rarr; marketingCloudVisitorId</td>
            <td>N</td>
            <td>Max size 128</td>
        </tr>
        <tr>
            <td>id &rarr; customerIds</td>
            <td>N</td>
            <td>
                <ul>
                    <li>No null elements</li>
                    <li>Max size 50</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>id &rarr; customerIds &rarr; id</td>
            <td>Y</td>
            <td>Max size 128</td>
        </tr>
        <tr>
            <td>id &rarr; customerIds &rarr; integrationCode</td>
            <td>Y</td>
            <td>Max size 50</td>
        </tr>
        <tr>
            <td>id &rarr; customerIds &rarr; authenticatedState</td>
            <td>Y</td>
            <td>unknown (default) | authenticated | logged_out</td>
        </tr>
        <tr>
            <td>profileParameters</td>
            <td>N</td>
            <td>
                <ul>
                    <li>Max count 50</li>
                    <li>no blank names</li>
                    <li>name size &lt;= 128</li>
                    <li>value size &lt;= 256</li>
                    <li>name should not start with &ldquo;profile.&rdquo;</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>environmentId</td>
            <td>N</td>
            <td>Valid client environment id</td>
        </tr>
        <tr>
            <td>host</td>
            <td>N</td>
            <td>Equivalent to mboxHost mbox parameter. (Length &lt; 128)</td>
        </tr>
        <tr>
            <td>ipAddress</td>
            <td>N</td>
            <td>Request IP address, defaults to origin IP address.</td>
        </tr>
        <tr>
            <td>contentAsJson</td>
            <td>N</td>
            <td>true | false</td>
        </tr>
        <tr>
            <td>mboxes</td>
            <td>N</td>
            <td>
                <ul>
                    <li>Max count 50</li>
                    <li>No null elements</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>mboxes &rarr; indexId</td>
            <td>Y</td>
            <td>
                <ul>
                    <li>Not null</li>
                    <li>&gt;= 0</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>mboxes &rarr; mbox</td>
            <td>Y</td>
            <td>
                <ul>
                    <li>not blank</li>
                    <li>no &rsquo;-clicked&rsquo; suffix</li>
                    <li>max size 250</li>
                    <li>values not allowed: &rsquo;** display mboxes /**&rsquo;, &rsquo;** any mbox **&rsquo;, &rsquo;** click from display mbox **&rsquo;</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>mboxes &rarr; clicked</td>
            <td>N</td>
            <td>
                <ul>
                    <li>Not null</li>
                    <li>true or false</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>mboxes &rarr; parameters</td>
            <td>N</td>
            <td> Mbox parameters associated with this mbox.
                <ul>
                    <li>max count 50</li>
                    <li>name not blank</li>
                    <li>name length <= 128</li>
                    <li>value length <= 5000</li>
                    <li>name should not start with &ldquo;profile.&rdquo;</li>
                    <li>not allowed names: &ldquo;orderId&rdquo;, &ldquo;orderTotal&rdquo;, &ldquo;productPurchasedId&rdquo;</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>mboxes &rarr; requestLocation &rarr; pageURL</td>
            <td>N</td>
            <td>Equivalent to mboxURL mbox parameter.</td>
        </tr>
        <tr>
            <td>mboxes &rarr; requestLocation &rarr; referrerURL</td>
            <td>N</td>
            <td>Equivalent to mboxReferrer mbox parameter</td>
        </tr>
        <tr>
            <td>mboxes &rarr; requestLocation &rarr; impressionId</td>
            <td>N</td>
            <td>Equivalent of pageId. A unique string (length &lt; 128) is generated with each request if no value was specified.</td>
        </tr>
        <tr>
            <td>mboxes &rarr; product</td>
            <td>N</td>
            <td></td>
        </tr>
        <tr>
            <td>mboxes &rarr; product &rarr; id</td>
            <td>N</td>
            <td>
                <ul>
                    <li>Not null</li>
                    <li>max size = 128</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>mboxes &rarr; product &rarr; categoryid</td>
            <td>N</td>
            <td>
                <ul>
                    <li>Not null</li>
                    <li>max size = 128</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>mboxes &rarr; order</td>
            <td>N</td>
            <td></td>
        </tr>
        <tr>
            <td>mboxes &rarr; order &rarr; id</td>
            <td>N</td>
            <td>
                <ul>
                    <li>max length = 250</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>mboxes &rarr; order &rarr; total</td>
            <td>N</td>
            <td>
                <ul>
                    <li>&gt;= 0</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>mboxes &rarr; order &rarr; purchasedProducts</td>
            <td>N</td>
            <td>
                <ul>
                    <li>No blank values</li>
                    <li>each value&rsquo;s max length 50</li>
                    <li>total ids length &lt;= 250</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>prefetch</td>
            <td>N</td>
            <td>
                <ul>
                    <li>Max count 50</li>
                    <li>No null elements</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>prefetch &rarr; indexId</td>
            <td>Y</td>
            <td>
                <ul>
                    <li>Not null</li>
                    <li>&gt;= 0</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>prefetch &rarr; mbox</td>
            <td>Y</td>
            <td>
                <ul>
                    <li>not blank</li>
                    <li>no &rsquo;-clicked&rsquo; suffix</li>
                    <li>max size 250</li>
                    <li>values not allowed: &rsquo;** display mboxes /**&rsquo;, &rsquo;** any mbox **&rsquo;, &rsquo;** click from display mbox **&rsquo;</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>prefetch &rarr; parameters</td>
            <td>N</td>
            <td>
                <ul>
                    <li>max count 50</li>
                    <li>name not blank</li>
                    <li>name length &lt;= 128</li>
                    <li>value length &lt;= 5000</li>
                    <li>name should not start with &ldquo;profile.&rdquo;</li>
                    <li>not allowed names: &ldquo;orderId&rdquo;, &ldquo;orderTotal&rdquo;, &ldquo;productPurchasedId&rdquo;</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>prefetch &rarr; product</td>
            <td>N</td>
            <td>-</td>
        </tr>
        <tr>
            <td>prefetch &rarr; product&nbsp;-&gt; id</td>
            <td>N</td>
            <td>
                <ul>
                    <li>Not blank</li>
                    <li>max size = 128</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>prefetch &rarr; product &rarr; categoryId</td>
            <td>N</td>
            <td>
                <ul>
                    <li>Not blank</li>
                    <li>max size = 128</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>prefetch &rarr; order</td>
            <td>N</td>
            <td>&nbsp;</td>
        </tr>
        <tr>
            <td>prefetch &rarr; order &rarr; id</td>
            <td>N</td>
            <td>max length = 250</td>
        </tr>
        <tr>
            <td>prefetch &rarr; order &rarr; total</td>
            <td>N</td>
            <td>&gt;= 0</td>
        </tr>
        <tr>
            <td>prefetch &rarr; order &rarr; purchasedProductIds</td>
            <td>N</td>
            <td>
                <ul>
                    <li>no blank values</li>
                    <li>each value&rsquo;s max length 50</li>
                    <li>total ids length &lt;= 250</li>
                </ul>
            </td>
        </tr>
        <tr>
            <td>notifications</td>
            <td>N</td>
            <td>Send notification requests for prefetched mboxes</td>
        </tr>
        <tr>
            <td>notifications &rarr; type</td>
            <td>N</td>
            <td>hit | click; Default is &ldquo;hit&rdquo;</td>
        </tr>
        <tr>
            <td>notifications &rarr; timestamp</td>
            <td>Y</td>
            <td>Indicates when the visitor visited the mbox. This should be a 10 digit UNIX timestamp in milliseconds.</td>
        </tr>
        <tr>
            <td>notifications &rarr; mbox</td>
            <td>Y</td>
            <td>mbox name</td>
        </tr>
        <tr>
            <td>notifications &rarr; parameters</td>
            <td>N</td>
            <td>Additional parameters with which the mbox was prefetched.</td>
        </tr>
        <tr>
            <td>notifications &rarr; eventTokens</td>
            <td>N</td>
            <td>encrypted representation of the event to be taken from the response of the prefetch call.</td>
        </tr>
        <tr>
            <td>notifications &rarr; clickToken</td>
            <td>N</td>
            <td>Encrypted representation of the click event to be taken from the response of the prefetch call.</td>
        </tr>
        <tr>
            <td>notifications &rarr; profileScriptToken</td>
            <td>N</td>
            <td>Encrypted representation of the executed profile scripts map.</td>
        </tr>
        <tr>
            <td>notifications &rarr; order</td>
            <td>N</td>
            <td>Accepts order details (id, total, purchasedProductIds) associated with this mbox notification.</td>
        </tr>
        <tr>
            <td>notifications &rarr; product</td>
            <td>N</td>
            <td>Accepts product details (id, categoryId) associated with this mbox notification.</td>
        </tr>
    </tbody>
</table>

<h2 id="integration-with-adobe-audience-manager">Integration with Adobe Audience Manager</h2>

<blockquote>
<p>Example: A sample request with AAM parameters.</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"aamParameters"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"blob"</span><span class="p">:</span><span class="w"> </span><span class="s2">"32fdghkjh34kj5h43"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"uuid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"82394234238798437"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dcsLocationHint"</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dataPartnerId"</span><span class="p">:</span><span class="w"> </span><span class="mi">86567576</span><span class="p">,</span><span class="w">
        </span><span class="s2">"dataPartnerUserId"</span><span class="p">:</span><span class="w"> </span><span class="mi">348382232423424</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<p>You can send AAM parameters with the Batch Mbox API to leverage AAM Audience Segments.</p>

<table>
    <tbody>
        <tr>
            <th>Field Name</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>dcsLocationHint</td>
            <td>Y</td>
            <td>DCS Location Hint is used to determine which AAM DCS Endpoint to hit in order to retrieve the profile. Must be &gt;= 1.</td>
        </tr>
        <tr>
            <td>uuid</td>
            <td>N</td>
            <td>AAM Unique user identifier is the internal AAM ID used to uniquely identify a user id. Must not be blank.</td>
        </tr>
        <tr>
            <td>dataPartnerId</td>
            <td>N</td>
            <td>AAM Data Partner ID is the ID for a Data Partner. Must be &gt;=1.</td>
        </tr>
        <tr>
            <td>dataPartnerUserId</td>
            <td>N</td>
            <td>AAM Data Partner Unique User Identifier is the user ID provided by a Data Partner. It must be a string.</td>
        </tr>
        <tr>
            <td>blob</td>
            <td>N</td>
            <td>AAM Blob is used to send additional data to AAM. Must not be blank and the size &lt;= 1024.</td>
        </tr>
    </tbody>
</table>

<h2 id="a4t-for-batch-delivery-api">A4T for Batch Delivery API</h2>

<blockquote>
<p>Example 1:  Response when a A4T-enabled campaign qualifies for the mbox/prefetch request.</p>
</blockquote>
<pre class="highlight plaintext"><code>{
   ...
   "mboxResponses":[ 
      { 
         "mbox":"homePageHero1",
         "content": "some content",
         "clientSideAnalyticsLoggingPayload": {
            "pe": "tnt",
            "tnta": "86492:0:0|0,86492:0:0|2,86492:0:0|1"
         }
      }
   ],
   "prefetchResponses":[ 
      { 
         "mbox":"homePageHero2",
         "content": "some content",
         "eventTokens": [...],
         "clientSideAnalyticsLoggingPayload": {
            "pe": "tnt",
            "tnta": "86494:0:0|0,86494:0:0|2,86494:0:0|1"
         }
      }
   ]
}
</code></pre>
<blockquote>
<p>Example 1: Sample request to the Analytics Tracking Server with the Target A4T Payload</p>
</blockquote>
<pre class="highlight shell"><code>curl -X GET <span class="se">\</span>
<span class="s1">'https://&lt;Analytics_Tracking_Server&gt;/b/ss/&lt;Report_Suite_IDs&gt;/0/&lt;Code_Version&gt;?pe=tnt&amp;tnta=86492:0:0|0,86492:0:0|2,86492:0:0|1,86494:0:0|0,86494:0:0|2,86494:0:0|1&amp;mcid=&lt;Marketing_Cloud_ID&gt;&amp;vid=&lt;Custom_Visitor_ID&gt;&amp;aid=&lt;Analytics_ID&gt;'</span>
</code></pre>
<p>In case any qualifying campaign is A4T enabled - target will send offer content containing also a payload (under a variable <em>clientSideAnalyticsLoggingPayload</em>) that should be logged by the client in Analytics using the Data Insertion API. A sample Target response and corresponding Analytics request is shown in the example alongside.</p>

<table>
    <tbody>
        <tr>
            <th>Field Name</th>
            <th>Required</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>Analytics_Tracking_Server</td>
            <td>Y</td>
            <td>The Analytics Tracking Server used in Target Reporting Destination.</td>
        </tr>
        <tr>
            <td>Report_Suite_IDs</td>
            <td>Y</td>
            <td>The Report Suite ID for the Report Suite used for the Target Activity. Multiple report suite IDs can be provided in a comma separated format.</td>
        </tr>
        <tr>
            <td>tnta</td>
            <td>Y</td>
            <td>Analytics payload (under the tnta variable) returned by Target server in clientSideAnalyticsLoggingPayload. Multiple payloads can be provided in a comma separated format.</td>
        </tr>
        <tr>
            <td>mcid</td>
            <td>N</td>
            <td>Marketing Cloud Visitor ID. This is optional, but recommended.</td>
        </tr>
        <tr>
            <td>vid</td>
            <td>N</td>
            <td>Custom Visitor ID</td>
        </tr>
        <tr>
            <td>aid</td>
            <td>N</td>
            <td>Analytics ID</td>
        </tr>
    </tbody>
</table>

<p>Note that the API used above is the Adobe Analytics Data Insertion API that can also be used as a POST request outlined <a href="https://helpx.adobe.com/analytics/kb/data-insertion-api-post-method-adobe-analytics.html">here</a>.</p>

<h2 id="best-practices-for-batch-delivery">Best Practices for Batch Delivery</h2>

<blockquote>
<p>Mbox response for a qualifying campaign with a click metric</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="s2">"mboxResponses"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="s2">"mbox"</span><span class="p">:</span><span class="w"> </span><span class="s2">"homePageHero1"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"content"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"clickToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1d2r"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<blockquote>
<p>Sample notification request for a mbox click event</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
   </span><span class="s2">"notifications"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"click"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1505944567000</span><span class="p">,</span><span class="w">
         </span><span class="s2">"mbox"</span><span class="p">:</span><span class="w"> </span><span class="s2">"homePageHero1"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"clickToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1d2r"</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<ol>
<li>It is not necessary to have all three kind of mboxes in a request. You can make a request for just a single mbox using this API.</li>
<li>Note that the profileParameters are set at the top level of a Batch request and all mboxes, prefetch or regular, will be associated with the same visitor profile.</li>
<li>When working with multiple mboxes in the batch mbox request, the Target edge will process the mboxes in the sequence specified by the IndexId parameter value.</li>
<li><strong>Overriding Parameters</strong>: You can override mbox parameters, such as IP, time.</li>
<li><strong>Prefetch:</strong> Fetch offers associated with an mbox in advance without incrementing the impression or visit/visitor count.

<ol>
<li>Make sure you manage the eventTokens associated with an mbox for use at the notifications stage.</li>
<li>When the qualifying campaign has a click metric defined for an mbox, then the <strong>clickToken</strong> will be <em>returned</em> in the response. When the visitor clicks the mbox and a notification request is sent, the notification <em>type</em> should be set to <em>click</em> and the corresponding <em>clickToken</em> should be included.</li>
</ol></li>
<li><strong>Notifications:</strong> There are two kinds of notifications - <em>hit</em> and <em>click</em>.</li>
<li><strong>Profile Scripts</strong> are executed per each mbox inside mboxes, prefetch and notifications, as per the following logic:

<ol>
<li><strong>Regular mbox</strong> (part of the mboxes array): Profile Scripts are executed and results persisted in the profile immediately. Note that the sequence of execution will be as per the IndexId of the mboxes.</li>
<li><strong>Prefetch mbox</strong> (part of the prefetch array): Target will execute the profile scripts and cache it without persisting it to the profile. A profileScriptToken will be returned in the response and should be included in the notification request for this mbox. The results will be persisted into the profile at this time.</li>
<li><strong>Notification mbox</strong> (part of the notification array): If the notification has the profileScriptToken, then the profile script values will be written to the profile without re-executing them. If the profileScriptToken is missing then the profile scripts will be executed and again and persisted to the profile.</li>
</ol></li>
<li>If <strong>Response Tokens</strong> are enabled, they will be returned for each mbox response in the mboxes and prefetch sections.</li>
</ol>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
